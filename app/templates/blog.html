{% extends "base.html" %}
{% block title %}Blog — IT Insights & Technology News | {{ site_settings.get('company_name', 'Right On Repair') }}{%
endblock %}
{% block meta_description %}Expert insights on cybersecurity, cloud computing, IT strategy, and technology trends. Stay
informed with the {{ site_settings.get('company_name', 'Right On Repair') }} blog.{% endblock %}
{% block og_title %}Blog — {{ site_settings.get('company_name', 'Right On Repair') }}{% endblock %}
{% block og_type %}blog{% endblock %}
{% block meta_keywords %}IT blog Orange County, cybersecurity tips, cloud computing insights, managed IT best
practices{% endblock %}

{% block structured_data %}
<script nonce="{{ csp_nonce }}" type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Blog",
  "name": {{ (site_settings.get('company_name', 'Right On Repair') ~ ' Blog') | tojson }},
  "description": "Expert insights on cybersecurity, cloud computing, IT strategy, and technology trends."
}
</script>
{% endblock %}

{% block content %}
<section class="page-header page-header--enhanced">
  <div class="page-header-glow" aria-hidden="true"></div>
  <div class="page-header-glow-2" aria-hidden="true"></div>
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('main.index') }}">Home</a></li>
        <li class="breadcrumb-item active">Blog</li>
      </ol>
    </nav>
    <div class="hero-accent-icon"><i class="fa-solid fa-newspaper"></i></div>
    <h1 class="gradient-shimmer">Blog & Insights</h1>
    {% include "_hero_slogan.html" %}
    <p>Expert perspectives on technology trends, cybersecurity, cloud computing, and IT best practices.</p>
  </div>
</section>

<section class="section section--layout-open">
  <div class="container">
    <div class="row g-5 page-layout-grid blog-layout-grid">
      <!-- Posts Grid -->
      <div class="col-lg-8">
        <!-- Search -->
        <form method="GET" action="{{ url_for('main.blog') }}" class="mb-5 reveal">
          <div class="search-bar">
            <i class="fa-solid fa-magnifying-glass search-bar-icon"></i>
            <input type="text" name="q" placeholder="Search articles..." value="{{ search or '' }}">
            <button type="submit"><i class="fa-solid fa-arrow-right"></i></button>
          </div>
        </form>

        {% if posts.items %}
        <div class="row g-4">
          {% for post in posts.items %}
          <div class="col-md-6">
            <article class="blog-card reveal stagger-{{ loop.index }}">
              {% if post.featured_image %}
              <img src="{{ url_for('admin.uploaded_file', filename=post.featured_image) }}" alt="{{ post.title }}"
                class="card-img-top" loading="lazy" decoding="async">
              {% else %}
              <div class="card-img-placeholder"><i class="fa-solid fa-newspaper"></i></div>
              {% endif %}
              <div class="card-body">
                {% if post.category %}
                <span class="badge-cat">{{ post.category.name }}</span>
                {% endif %}
                <h3><a href="{{ url_for('main.post', slug=post.slug) }}">{{ post.title }}</a></h3>
                {% set excerpt_text = post.excerpt or post.content or '' %}
                <p class="excerpt">{{ excerpt_text[:120] }}{% if excerpt_text|length > 120 %}...{% endif %}</p>
                <div class="card-meta">
                  <span><i class="fa-regular fa-calendar me-1"></i> {{ post.created_at.strftime('%b %d, %Y') if
                    post.created_at else 'Recently updated' }}</span>
                  <a href="{{ url_for('main.post', slug=post.slug) }}" class="blog-read-link">Read More <i
                      class="fa-solid fa-arrow-right ms-1 blog-read-icon"></i></a>
                </div>
              </div>
            </article>
          </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if posts.has_prev or posts.has_next %}
        <nav class="mt-5 d-flex justify-content-center reveal">
          <ul class="pagination">
            {% if posts.has_prev %}
            <li class="page-item"><a class="page-link"
                href="{{ url_for('main.blog', page=posts.prev_num, category=current_category, q=search) }}">&larr;
                Previous</a></li>
            {% endif %}
            {% for p in posts.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
            {% if p %}
            <li class="page-item {% if p == posts.page %}active{% endif %}"><a class="page-link"
                href="{{ url_for('main.blog', page=p, category=current_category, q=search) }}">{{ p }}</a></li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">&hellip;</span></li>
            {% endif %}
            {% endfor %}
            {% if posts.has_next %}
            <li class="page-item"><a class="page-link"
                href="{{ url_for('main.blog', page=posts.next_num, category=current_category, q=search) }}">Next
                &rarr;</a></li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}

        {% else %}
        <div class="text-center py-5 reveal">
          <i class="fa-solid fa-magnifying-glass blog-empty-icon"></i>
          <h3 class="mt-3 blog-empty-title">No articles found</h3>
          <p class="blog-empty-text">Try a different search term or browse by category.</p>
        </div>
        {% endif %}
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4 blog-sidebar">
        <div class="sidebar-filter reveal-right">
          <h4>Categories</h4>
          <a href="{{ url_for('main.blog') }}" class="filter-link {% if not current_category %}active{% endif %}">All
            Posts</a>
          {% for cat in categories %}
          <a href="{{ url_for('main.blog', category=cat.slug) }}"
            class="filter-link {% if current_category == cat.slug %}active{% endif %}">{{ cat.name }}</a>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CTA -->
<section class="section-sm section-bottom-spacious">
  <div class="cta-section reveal-scale">
    <div class="cta-inner">
      <h2>Need IT Expertise?</h2>
      <p>Our team is ready to help with any technology challenge your business faces.</p>
      <div class="cta-actions cta-actions-dual">
        {% if site_settings.get('phone') %}
        <a href="tel:{{ site_settings.phone | replace(' ', '') | replace('(', '') | replace(')', '') | replace('-', '') }}"
          class="btn btn-call"><i class="fa-solid fa-phone"></i> Call Now</a>
        {% endif %}
        <a href="{{ url_for('main.request_quote') }}" class="btn btn-primary">Request a Quote <i
            class="fa-solid fa-arrow-right"></i></a>
        <a href="{{ url_for('main.remote_support') }}" class="btn btn-remote-support"><i
            class="fa-solid fa-life-ring"></i> Remote Support</a>
        <a href="{{ url_for('main.contact', subject='Support Message') }}" class="btn btn-danger"><i
            class="fa-solid fa-envelope"></i> Send Message</a>
      </div>
    </div>
  </div>
</section>
{% endblock %}